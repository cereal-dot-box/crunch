type Query
type Mutation

schema {
  query: Query
  mutation: Mutation
}

type Account {
  id: Int!
  name: String!
  bank: String
  type: String
  mask: String
  current_balance: Float
  available_balance: Float
  iso_currency_code: String!
  is_active: Boolean!
  created_at: String!
  updated_at: String!
}

input AddAccountInput {
  name: String!
  bank: String!
  type: String!
  mask: String!
  iso_currency_code: String!
}

input AddSyncSourceInput {
  account_id: Int!
  name: String!
  email_address: String!
  imap_host: String!
  imap_port: Int!
  imap_password: String!
  imap_folder: String
}

type AvailableBankType {
  bank: String!
  types: [String!]!
}

type BudgetBucket {
  id: Int!
  bucket_id: String!
  name: String!
  monthly_limit: Float!
  color: String!
  is_active: Boolean!
  created_at: String!
  updated_at: String!
}

input CreateMonthlyPeriodInput {
  month: String!
  projected_income: Float!
  notes: String
}

type MonthlyPeriod {
  id: Int!
  user_id: ID!
  month: String!
  projected_income: Float!
  actual_income: Float!
  status: String!
  notes: String
  created_at: String!
  updated_at: String!
  is_open: Boolean!
  is_closed: Boolean!
}

extend type Mutation {
  add_account(userId: ID!, input: AddAccountInput!): Account!
  add_sync_source(userId: ID!, input: AddSyncSourceInput!): SyncSource!
  close_monthly_period(userId: ID!, id: Int!): MonthlyPeriod!
  create_monthly_period(userId: ID!, input: CreateMonthlyPeriodInput!): MonthlyPeriod!
  deactivate_account(userId: ID!, account_id: Int!): Boolean!
  delete_monthly_period(userId: ID!, id: Int!): Boolean!
  delete_sync_source(userId: ID!, id: Int!): Boolean!
  initialize_default_buckets(userId: ID!): [BudgetBucket!]!
  splitwise_complete_oauth(userId: ID!, code: String!, state: String!): SplitwiseCredential!
  splitwise_disconnect(userId: ID!): Boolean!
  splitwise_update_settings(userId: ID!, input: UpdateSplitwiseSettingsInput!): SplitwiseSetting!
  sync_accounts(userId: ID!): Boolean!
  sync_sync_source(userId: ID!, id: Int!): SyncResult!
  test_sync_source_connection(userId: ID!, id: Int!): TestConnectionResult!
  update_budget_bucket(userId: ID!, bucket_id: String!, input: UpdateBudgetBucketInput!): BudgetBucket!
  update_monthly_period(userId: ID!, id: Int!, input: UpdateMonthlyPeriodInput!): MonthlyPeriod!
  update_sync_source(userId: ID!, id: Int!, input: UpdateSyncSourceInput!): SyncSource!
}

extend type Query {
  accounts(userId: ID!): [Account!]!
  available_bank_types: [AvailableBankType!]!
  budget_bucket(userId: ID!, bucket_id: String!): BudgetBucket
  budget_buckets(userId: ID!): [BudgetBucket!]!
  current_monthly_period(userId: ID!): MonthlyPeriod
  monthly_period(userId: ID!, month: String!): MonthlyPeriod
  monthly_periods(userId: ID!): [MonthlyPeriod!]!
  splitwise_authorize_url(userId: ID!): SplitwiseAuthorizeUrl!
  splitwise_credential(userId: ID!): SplitwiseCredential
  splitwise_groups(userId: ID!): [SplitwiseGroup!]!
  splitwise_settings(userId: ID!): SplitwiseSetting!
  sync_source(userId: ID!, id: Int!): SyncSource
  sync_sources(userId: ID!): [SyncSource!]!
  sync_sources_by_account(userId: ID!, account_id: Int!): [SyncSource!]!
  transaction(userId: ID!, id: Int!): Transaction
  transactions(userId: ID!, limit: Int, offset: Int): TransactionListResponse!
  transactions_by_account(userId: ID!, account_id: Int!, limit: Int, offset: Int): TransactionListResponse!
}

type SplitwiseAuthorizeUrl {
  url: String!
}

type SplitwiseCredential {
  id: Int!
  user_id: ID!
  splitwise_user_id: ID!
  created_at: String!
  updated_at: String!
}

type SplitwiseGroup {
  id: Int!
  name: String!
  updated_at: String!
  members: [SplitwiseGroupMember!]!
}

type SplitwiseGroupMember {
  id: Int!
  first_name: String!
  last_name: String
  email: String!
}

type SplitwiseSetting {
  id: Int!
  user_id: ID!
  included_group_ids: [Int!]!
  auto_sync_enabled: Boolean!
  created_at: String!
  updated_at: String!
}

type SyncResult {
  timestamp: String!
  emails_fetched: Int!
  jobs_enqueued: Int!
  errors: Int!
  duration: Int!
}

type SyncSource {
  id: Int!
  account_id: Int!
  name: String!
  email_address: String!
  imap_host: String!
  imap_port: Int!
  imap_folder: String!
  status: String!
  last_synced_at: String
  last_processed_uid: String
  is_active: Boolean!
  created_at: String!
  balance_count: Int
  transaction_count: Int
}

type TestConnectionResult {
  success: Boolean!
  error_message: String
}

type Transaction {
  id: Int!
  transaction_id: String!
  account_id: Int!
  amount: Float!
  iso_currency_code: String!
  date: String!
  authorized_date: String
  name: String!
  merchant_name: String
  pending: Boolean!
  payment_channel: String
  created_at: String!
  updated_at: String!
}

type TransactionListResponse {
  transactions: [Transaction!]!
  total: Int!
}

input UpdateBudgetBucketInput {
  name: String
  monthly_limit: Float
  color: String
}

input UpdateMonthlyPeriodInput {
  projected_income: Float
  actual_income: Float
  status: String
  notes: String
}

input UpdateSplitwiseSettingsInput {
  included_group_ids: [Int!]
  auto_sync_enabled: Boolean
}

input UpdateSyncSourceInput {
  name: String
  email_address: String
  imap_host: String
  imap_port: Int
  imap_password: String
  imap_folder: String
}