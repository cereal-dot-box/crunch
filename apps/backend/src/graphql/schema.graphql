type Account {
  id: Int!
  name: String!
  bank: String
  type: String
  mask: String
  current_balance: Float
  available_balance: Float
  iso_currency_code: String!
  is_active: Boolean!
  created_at: String!
  updated_at: String!
}

type BudgetBucket {
  id: Int!
  bucket_id: String!
  name: String!
  monthly_limit: Float!
  color: String!
  is_active: Boolean!
  created_at: String!
  updated_at: String!
}

input UpdateBudgetBucketInput {
  name: String
  monthly_limit: Float
  color: String
}

type MonthlyPeriod {
  id: Int!
  user_id: ID!
  month: String!
  projected_income: Float!
  actual_income: Float!
  status: String!
  notes: String
  created_at: String!
  updated_at: String!
  is_open: Boolean!
  is_closed: Boolean!
}

input CreateMonthlyPeriodInput {
  month: String!
  projected_income: Float!
  notes: String
}

input UpdateMonthlyPeriodInput {
  projected_income: Float
  actual_income: Float
  status: String
  notes: String
}

type Transaction {
  id: Int!
  transaction_id: String!
  account_id: Int!
  amount: Float!
  iso_currency_code: String!
  date: String!
  authorized_date: String
  name: String!
  merchant_name: String
  pending: Boolean!
  payment_channel: String
  created_at: String!
  updated_at: String!
}

type TransactionListResponse {
  transactions: [Transaction!]!
  total: Int!
}

type SyncSource {
  id: Int!
  account_id: Int!
  name: String!
  email_address: String!
  imap_host: String!
  imap_port: Int!
  imap_folder: String!
  status: String!
  last_synced_at: String
  last_processed_uid: String
  is_active: Boolean!
  created_at: String!
  balance_count: Int
  transaction_count: Int
}

# Extended SyncSource type for scheduler (includes encrypted password)
type SchedulerSyncSource {
  id: Int!
  name: String!
  bank: String
  accountType: String
  accountId: Int!
  emailAddress: String!
  imapHost: String!
  imapPort: Int!
  imapPasswordEncrypted: String!
  imapFolder: String!
  lastProcessedUid: String
  userId: ID!
}

type TestConnectionResult {
  success: Boolean!
  error_message: String
}

type SyncResult {
  timestamp: String!
  emails_fetched: Int!
  jobs_enqueued: Int!
  errors: Int!
  duration: Int!
}

type SplitwiseCredential {
  id: Int!
  user_id: ID!
  splitwise_user_id: ID!
  created_at: String!
  updated_at: String!
}

type SplitwiseSetting {
  id: Int!
  user_id: ID!
  included_group_ids: [Int!]!
  auto_sync_enabled: Boolean!
  created_at: String!
  updated_at: String!
}

type SplitwiseGroup {
  id: Int!
  name: String!
  updated_at: String!
  members: [SplitwiseGroupMember!]!
}

type SplitwiseGroupMember {
  id: Int!
  first_name: String!
  last_name: String
  email: String!
}

type SplitwiseAuthorizeUrl {
  url: String!
}

# Worker types and mutations
type ProcessedEmail {
  id: Int!
  messageUid: String!
}

input MarkEmailProcessedInput {
  userId: ID!
  syncSourceId: Int!
  messageUid: String!
}

input CreateTransactionFromEmailInput {
  userId: ID!
  accountId: Int!
  syncSourceId: Int!
  processedEmailId: Int!
  amount: Float!
  transactionDate: String!
  name: String!
  merchantName: String
}

input CreateBalanceUpdateFromEmailInput {
  userId: ID!
  accountId: Int!
  syncSourceId: Int!
  processedEmailId: Int!
  balanceType: String!
  newBalance: Float!
  updateSource: String!
  sourceDetail: String!
  updateDate: String!
}

input CreateDLQEntryInput {
  userId: ID!
  syncSourceId: Int!
  messageUid: String!
  subject: String!
  fromAddress: String!
  date: String!
  bodyText: String!
  bodyHtml: String
  errorMessage: String!
  errorType: String!
  errorStack: String
}

type AvailableBankType {
  bank: String!
  types: [String!]!
}

input AddAccountInput {
  name: String!
  bank: String!
  type: String!
  mask: String!
  iso_currency_code: String!
}

input AddSyncSourceInput {
  account_id: Int!
  name: String!
  email_address: String!
  imap_host: String!
  imap_port: Int!
  imap_password: String!
  imap_folder: String
}

input UpdateSyncSourceInput {
  name: String
  email_address: String
  imap_host: String
  imap_port: Int
  imap_password: String
  imap_folder: String
}

input UpdateSplitwiseSettingsInput {
  included_group_ids: [Int!]
  auto_sync_enabled: Boolean
}

type Query {
  accounts(userId: ID!): [Account!]!
  budget_buckets(userId: ID!): [BudgetBucket!]!
  budget_bucket(userId: ID!, bucket_id: String!): BudgetBucket
  monthly_periods(userId: ID!): [MonthlyPeriod!]!
  monthly_period(userId: ID!, month: String!): MonthlyPeriod
  current_monthly_period(userId: ID!): MonthlyPeriod
  transactions_by_account(userId: ID!, account_id: Int!, limit: Int, offset: Int): TransactionListResponse!
  transactions(userId: ID!, limit: Int, offset: Int): TransactionListResponse!
  transaction(userId: ID!, id: Int!): Transaction
  sync_sources(userId: ID!): [SyncSource!]!
  sync_sources_by_account(userId: ID!, account_id: Int!): [SyncSource!]!
  sync_source(userId: ID!, id: Int!): SyncSource
  # Query for scheduler to get all active sync sources (requires internal authentication)
  activeSyncSources: [SchedulerSyncSource!]!
  available_bank_types: [AvailableBankType!]!
  splitwise_authorize_url(userId: ID!): SplitwiseAuthorizeUrl!
  splitwise_credential(userId: ID!): SplitwiseCredential
  splitwise_groups(userId: ID!): [SplitwiseGroup!]!
  splitwise_settings(userId: ID!): SplitwiseSetting!
  # Worker queries (requires internal authentication)
  processedEmail(syncSourceId: Int!, messageUid: String!): ProcessedEmail
  workerSyncSource(id: Int!, userId: ID!): SchedulerSyncSource
}

type Mutation {
  initialize_default_buckets(userId: ID!): [BudgetBucket!]!
  add_account(userId: ID!, input: AddAccountInput!): Account!
  add_sync_source(userId: ID!, input: AddSyncSourceInput!): SyncSource!
  update_sync_source(userId: ID!, id: Int!, input: UpdateSyncSourceInput!): SyncSource!
  sync_accounts(userId: ID!): Boolean!
  deactivate_account(userId: ID!, account_id: Int!): Boolean!
  update_budget_bucket(userId: ID!, bucket_id: String!, input: UpdateBudgetBucketInput!): BudgetBucket!
  create_monthly_period(userId: ID!, input: CreateMonthlyPeriodInput!): MonthlyPeriod!
  update_monthly_period(userId: ID!, id: Int!, input: UpdateMonthlyPeriodInput!): MonthlyPeriod!
  close_monthly_period(userId: ID!, id: Int!): MonthlyPeriod!
  delete_monthly_period(userId: ID!, id: Int!): Boolean!
  delete_sync_source(userId: ID!, id: Int!): Boolean!
  test_sync_source_connection(userId: ID!, id: Int!): TestConnectionResult!
  sync_sync_source(userId: ID!, id: Int!): SyncResult!
  splitwise_complete_oauth(userId: ID!, code: String!, state: String!): SplitwiseCredential!
  splitwise_disconnect(userId: ID!): Boolean!
  splitwise_update_settings(userId: ID!, input: UpdateSplitwiseSettingsInput!): SplitwiseSetting!
  # Worker mutations (requires internal authentication)
  markEmailProcessed(input: MarkEmailProcessedInput!): ProcessedEmail!
  createTransactionFromEmail(input: CreateTransactionFromEmailInput!): Transaction!
  createBalanceUpdateFromEmail(input: CreateBalanceUpdateFromEmailInput!): Boolean!
  createDLQEntry(input: CreateDLQEntryInput!): Boolean!
}
